{% extends "base.html" %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('check_in_start') }}">Step 1: License Plate</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('check_in_areas', license_plate=license_plate) }}">Step 2: Select Area</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('check_in_lots', license_plate=license_plate, area_name=lot.area) }}">Step 3: Select Lot</a></li>
        <li class="breadcrumb-item active" aria-current="page">Step 4: Select Slot</li>
    </ol>
</nav>

<h1 class="mb-4">Select a Slot for <span class="text-primary">{{ license_plate }}</span> in {{ lot.name }}</h1>
<p class="lead">Only available or reserved slots are clickable for check-in.</p>



<style>
    .slot-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 15px;
    }
    .slot-btn {
        border: none;
        border-radius: 0.375rem;
        padding: 15px;
        text-align: center;
        font-weight: bold;
        color: white;
        width: 100%;
        height: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    .slot-btn .slot-type {
        font-size: 0.8rem;
        font-weight: normal;
    }
    .slot-btn:disabled {
        color: #ccc;
        cursor: not-allowed;
    }
</style>

<div class="legend">
    <div class="legend-item"><div class="legend-color status-available"></div><span>Available</span></div>
    <div class="legend-item"><div class="legend-color status-occupied"></div><span>Occupied</span></div>
    <div class="legend-item"><div class="legend-color status-reserved"></div><span>Reserved</span></div>
</div>

<form method="POST" action="{{ url_for('check_in_slots', license_plate=license_plate, lot_id=lot.id) }}">
    <div class="mb-3">
        <label for="duration_hours" class="form-label">Expected Duration (hours)</label>
        <input type="number" class="form-control" id="duration_hours" name="duration_hours" value="1" min="1">
    </div>
    <div class="slot-grid">
        {% for slot in lot.slots|sort(attribute='slot_number') %}
            <button type="submit" name="slot_id" value="{{ slot.id }}" class="slot-btn status-{{ slot.status }}" {% if slot.status == 'occupied' %}disabled{% endif %}>
                <span>{{ slot.slot_number }}</span>
                <span class="slot-type">({{ slot.slot_type }})</span>
            </button>
        {% else %}
            <p>This parking lot has no slots configured.</p>
        {% endfor %}
    </div>
</form>

{% endblock %}
